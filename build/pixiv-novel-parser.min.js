!function(a){var b="process"in a,c=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(yc,xc)}function d(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return zc!==b&&(zc>b&&(zc=0,Ac={line:1,column:1,seenCR:!1}),c(Ac,zc,b),zc=b),Ac}function e(a){Bc>xc||(xc>Bc&&(Bc=xc,Cc=[]),Cc.push(a))}function f(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=d(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==c?c:h(e,j),e,j,f,i.line,i.column)}function g(){var a;return a=h()}function h(){var a,b;for(a=[],b=j(),b===R&&(b=i());b!==R;)a.push(b),b=j(),b===R&&(b=i());return a}function i(){var b,c,d,f,g,h,i;if(b=xc,c=xc,d=[],f=[],V.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(W)),g!==R)for(;g!==R;)f.push(g),V.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(W));else f=U;if(f===R&&(f=xc,g=xc,Dc++,h=xc,Dc++,i=j(),Dc--,i===R?h=X:(xc=h,h=U),Dc--,h!==R?(xc=g,g=X):g=U,g!==R?(91===a.charCodeAt(xc)?(h=Y,xc++):(h=R,0===Dc&&e(Z)),h!==R?(g=[g,h],f=g):(xc=f,f=U)):(xc=f,f=U)),f!==R)for(;f!==R;){if(d.push(f),f=[],V.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(W)),g!==R)for(;g!==R;)f.push(g),V.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(W));else f=U;f===R&&(f=xc,g=xc,Dc++,h=xc,Dc++,i=j(),Dc--,i===R?h=X:(xc=h,h=U),Dc--,h!==R?(xc=g,g=X):g=U,g!==R?(91===a.charCodeAt(xc)?(h=Y,xc++):(h=R,0===Dc&&e(Z)),h!==R?(g=[g,h],f=g):(xc=f,f=U)):(xc=f,f=U))}else d=U;return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=$(c)),b=c}function j(){var a,b;return a=k(),a===R&&(a=l(),a===R&&(a=m(),a===R&&(a=n(),a===R&&(a=o(),a===R&&(a=xc,b=v(),b!==R&&(yc=a,b=_()),a=b,a===R&&(a=xc,b=w(),b!==R&&(yc=a,b=_()),a=b,a===R&&(a=xc,b=x(),b!==R&&(yc=a,b=_()),a=b))))))),a}function k(){var b,c,d;return b=xc,a.substr(xc,9)===ab?(c=ab,xc+=9):(c=R,0===Dc&&e(bb)),c!==R?(d=A(),d===R&&(d=E()),d===R&&(d=cb),d!==R?(yc=b,c=db(),b=c):(xc=b,b=U)):(xc=b,b=U),b}function l(){var b,c,d,f,g;return b=xc,a.substr(xc,9)===eb?(c=eb,xc+=9):(c=R,0===Dc&&e(fb)),c!==R?(d=p(),d!==R?(93===a.charCodeAt(xc)?(f=gb,xc++):(f=R,0===Dc&&e(hb)),f!==R?(g=A(),g===R&&(g=E()),g===R&&(g=cb),g!==R?(yc=b,c=ib(d),b=c):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U),b}function m(){var b,c,d,f,g,h;return b=xc,a.substr(xc,12)===jb?(c=jb,xc+=12):(c=R,0===Dc&&e(kb)),c!==R?(d=r(),d!==R?(f=xc,45===a.charCodeAt(xc)?(g=lb,xc++):(g=R,0===Dc&&e(mb)),g!==R?(h=s(),h!==R?(g=[g,h],f=g):(xc=f,f=U)):(xc=f,f=U),f===R&&(f=cb),f!==R?(93===a.charCodeAt(xc)?(g=gb,xc++):(g=R,0===Dc&&e(hb)),g!==R?(yc=b,c=nb(d,f),b=c):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U),b}function n(){var b,c,d,f;return b=xc,a.substr(xc,6)===ob?(c=ob,xc+=6):(c=R,0===Dc&&e(pb)),c!==R?(d=s(),d!==R?(93===a.charCodeAt(xc)?(f=gb,xc++):(f=R,0===Dc&&e(hb)),f!==R?(yc=b,c=qb(d),b=c):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U),b}function o(){var b,c,d,f,g,h,i,j;if(b=xc,a.substr(xc,10)===rb?(c=rb,xc+=10):(c=R,0===Dc&&e(sb)),c!==R)if(d=q(),d!==R)if(62===a.charCodeAt(xc)?(f=tb,xc++):(f=R,0===Dc&&e(ub)),f!==R){for(g=[],h=G();h!==R;)g.push(h),h=G();if(g!==R)if(h=t(),h!==R){for(i=[],j=G();j!==R;)i.push(j),j=G();i!==R?(a.substr(xc,2)===vb?(j=vb,xc+=2):(j=R,0===Dc&&e(wb)),j!==R?(yc=b,c=xb(d,h),b=c):(xc=b,b=U)):(xc=b,b=U)}else xc=b,b=U;else xc=b,b=U}else xc=b,b=U;else xc=b,b=U;else xc=b,b=U;return b}function p(){var b,c,d,f;for(b=xc,c=xc,d=[],yb.test(a.charAt(xc))?(f=a.charAt(xc),xc++):(f=R,0===Dc&&e(zb));f!==R;)d.push(f),yb.test(a.charAt(xc))?(f=a.charAt(xc),xc++):(f=R,0===Dc&&e(zb));return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=Ab(c)),b=c}function q(){var b,c,d,f;for(b=xc,c=xc,d=[],Bb.test(a.charAt(xc))?(f=a.charAt(xc),xc++):(f=R,0===Dc&&e(Cb));f!==R;)d.push(f),Bb.test(a.charAt(xc))?(f=a.charAt(xc),xc++):(f=R,0===Dc&&e(Cb));return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=Ab(c)),b=c}function r(){var b,c,d;if(b=xc,c=[],d=B(),d!==R)for(;d!==R;)c.push(d),d=B();else c=U;return c!==R&&(c=a.substring(b,xc)),b=c}function s(){var b,c,d,e;if(b=xc,c=xc,d=[],e=B(),e!==R)for(;e!==R;)d.push(e),e=B();else d=U;return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=Db(c)),b=c}function t(){var b,c,d,f,g,h,i;if(b=xc,c=xc,d=xc,f=xc,a.substr(xc,4)===Eb?(g=Eb,xc+=4):(g=R,0===Dc&&e(Fb)),g!==R?(115===a.charCodeAt(xc)?(h=Gb,xc++):(h=R,0===Dc&&e(Hb)),h===R&&(h=cb),h!==R?(g=[g,h],f=g):(xc=f,f=U)):(xc=f,f=U),f===R&&(f=cb),f!==R)if(a.substr(xc,3)===Ib?(g=Ib,xc+=3):(g=R,0===Dc&&e(Jb)),g!==R){for(h=[],i=u();i!==R;)h.push(i),i=u();h!==R?(f=[f,g,h],d=f):(xc=d,d=U)}else xc=d,d=U;else xc=d,d=U;return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=Kb(c)),b=c}function u(){var b,c,d,f;if(b=z(),b===R&&(b=B(),b===R)){if(b=xc,37===a.charCodeAt(xc)?(c=Lb,xc++):(c=R,0===Dc&&e(Mb)),c!==R){if(d=[],f=C(),f!==R)for(;f!==R;)d.push(f),f=C();else d=U;d!==R?(c=[c,d],b=c):(xc=b,b=U)}else xc=b,b=U;b===R&&(Nb.test(a.charAt(xc))?(b=a.charAt(xc),xc++):(b=R,0===Dc&&e(Ob)))}return b}function v(){var b,c,d,f,g,h,i;if(b=xc,a.substr(xc,6)===Pb?(c=Pb,xc+=6):(c=R,0===Dc&&e(Qb)),c!==R){for(d=xc,f=[],Bb.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(Cb));g!==R;)f.push(g),Bb.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(Cb));if(f!==R&&(f=a.substring(d,xc)),d=f,d!==R)if(62===a.charCodeAt(xc)?(f=tb,xc++):(f=R,0===Dc&&e(ub)),f!==R){for(g=xc,h=[],yb.test(a.charAt(xc))?(i=a.charAt(xc),xc++):(i=R,0===Dc&&e(zb));i!==R;)h.push(i),yb.test(a.charAt(xc))?(i=a.charAt(xc),xc++):(i=R,0===Dc&&e(zb));h!==R&&(h=a.substring(g,xc)),g=h,g!==R?(93===a.charCodeAt(xc)?(h=gb,xc++):(h=R,0===Dc&&e(hb)),h!==R?(yc=b,c=Rb(d,g),b=c):(xc=b,b=U)):(xc=b,b=U)}else xc=b,b=U;else xc=b,b=U}else xc=b,b=U;return b}function w(){var b,c,d,f;return b=xc,a.substr(xc,7)===Sb?(c=Sb,xc+=7):(c=R,0===Dc&&e(Tb)),c!==R?(d=y(),d!==R?(93===a.charCodeAt(xc)?(f=gb,xc++):(f=R,0===Dc&&e(hb)),f!==R?(yc=b,c=Ub(d),b=c):(xc=b,b=U)):(xc=b,b=U)):(xc=b,b=U),b}function x(){var b,c,d,f,g;if(b=xc,a.substr(xc,8)===Vb?(c=Vb,xc+=8):(c=R,0===Dc&&e(Wb)),c!==R){for(d=xc,f=[],yb.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(zb));g!==R;)f.push(g),yb.test(a.charAt(xc))?(g=a.charAt(xc),xc++):(g=R,0===Dc&&e(zb));f!==R&&(f=a.substring(d,xc)),d=f,d!==R?(93===a.charCodeAt(xc)?(f=gb,xc++):(f=R,0===Dc&&e(hb)),f!==R?(yc=b,c=Xb(d),b=c):(xc=b,b=U)):(xc=b,b=U)}else xc=b,b=U;return b}function y(){var b,c,d,f;if(b=xc,c=xc,d=[],f=z(),f===R&&(f=B(),f===R&&(45===a.charCodeAt(xc)?(f=lb,xc++):(f=R,0===Dc&&e(mb)))),f!==R)for(;f!==R;)d.push(f),f=z(),f===R&&(f=B(),f===R&&(45===a.charCodeAt(xc)?(f=lb,xc++):(f=R,0===Dc&&e(mb))));else d=U;return d!==R&&(d=a.substring(c,xc)),c=d,c!==R&&(yc=b,c=Yb(c)),b=c}function z(){var b;return Zb.test(a.charAt(xc))?(b=a.charAt(xc),xc++):(b=R,0===Dc&&e($b)),b===R&&(_b.test(a.charAt(xc))?(b=a.charAt(xc),xc++):(b=R,0===Dc&&e(ac))),b}function A(){var b;return 13===a.charCodeAt(xc)?(b=bc,xc++):(b=R,0===Dc&&e(cc)),b}function B(){var b;return dc.test(a.charAt(xc))?(b=a.charAt(xc),xc++):(b=R,0===Dc&&e(ec)),b}function C(){var b;return b=B(),b===R&&(65===a.charCodeAt(xc)?(b=fc,xc++):(b=R,0===Dc&&e(gc)),b===R&&(66===a.charCodeAt(xc)?(b=hc,xc++):(b=R,0===Dc&&e(ic)),b===R&&(67===a.charCodeAt(xc)?(b=jc,xc++):(b=R,0===Dc&&e(kc)),b===R&&(68===a.charCodeAt(xc)?(b=lc,xc++):(b=R,0===Dc&&e(mc)),b===R&&(69===a.charCodeAt(xc)?(b=nc,xc++):(b=R,0===Dc&&e(oc)),b===R&&(70===a.charCodeAt(xc)?(b=pc,xc++):(b=R,0===Dc&&e(qc)))))))),b}function D(){var b;return 9===a.charCodeAt(xc)?(b=rc,xc++):(b=R,0===Dc&&e(sc)),b}function E(){var b;return 10===a.charCodeAt(xc)?(b=tc,xc++):(b=R,0===Dc&&e(uc)),b}function F(){var b;return 32===a.charCodeAt(xc)?(b=vc,xc++):(b=R,0===Dc&&e(wc)),b}function G(){var a;return a=F(),a===R&&(a=D()),a}function c(a){return{type:"text",val:a}}function H(){return{type:"tag",name:"newpage"}}function I(a){return{type:"tag",name:"chapter",title:a}}function J(a,b){return{type:"tag",name:"pixivimage",illustID:a,pageNumber:b||null}}function K(a){return{type:"tag",name:"jump",pageNumber:a}}function L(a,b){return{type:"tag",name:"jumpuri",title:a,uri:b}}function M(a,b){return{type:"tag",name:"ruby",rubyBase:a,rubyText:b}}function N(a){return{type:"tag",name:"emoji",emojiName:a}}function O(a){return{type:"tag",name:"strong",val:a}}var P,Q=arguments.length>1?arguments[1]:{},R={},S={start:g},T=g,U=R,V=/^[^[]/,W={type:"class",value:"[^[]",description:"[^[]"},X=void 0,Y="[",Z={type:"literal",value:"[",description:'"["'},$=function(a){return c(a)},_=function(){return __$__},ab="[newpage]",bb={type:"literal",value:"[newpage]",description:'"[newpage]"'},cb=null,db=function(){return H()},eb="[chapter:",fb={type:"literal",value:"[chapter:",description:'"[chapter:"'},gb="]",hb={type:"literal",value:"]",description:'"]"'},ib=function(a){return I(a)},jb="[pixivimage:",kb={type:"literal",value:"[pixivimage:",description:'"[pixivimage:"'},lb="-",mb={type:"literal",value:"-",description:'"-"'},nb=function(a,b){return J(a,b&&b[1])},ob="[jump:",pb={type:"literal",value:"[jump:",description:'"[jump:"'},qb=function(a){return K(a)},rb="[[jumpuri:",sb={type:"literal",value:"[[jumpuri:",description:'"[[jumpuri:"'},tb=">",ub={type:"literal",value:">",description:'">"'},vb="]]",wb={type:"literal",value:"]]",description:'"]]"'},xb=function(a,b){return L(a,b)},yb=/^[^\]]/,zb={type:"class",value:"[^\\]]",description:"[^\\]]"},Ab=function(a){return a.trim()},Bb=/^[^>]/,Cb={type:"class",value:"[^>]",description:"[^>]"},Db=function(a){return parseInt(a,10)},Eb="http",Fb={type:"literal",value:"http",description:'"http"'},Gb="s",Hb={type:"literal",value:"s",description:'"s"'},Ib="://",Jb={type:"literal",value:"://",description:'"://"'},Kb=function(a){return a},Lb="%",Mb={type:"literal",value:"%",description:'"%"'},Nb=/^[\-._~!$&'()*+,;=:\/@.?#]/,Ob={type:"class",value:"[\\-._~!$&'()*+,;=:\\/@.?#]",description:"[\\-._~!$&'()*+,;=:\\/@.?#]"},Pb="[ruby:",Qb={type:"literal",value:"[ruby:",description:'"[ruby:"'},Rb=function(a,b){return M(a.trim(),b.trim())},Sb="[emoji:",Tb={type:"literal",value:"[emoji:",description:'"[emoji:"'},Ub=function(a){return N(a)},Vb="[strong:",Wb={type:"literal",value:"[strong:",description:'"[strong:"'},Xb=function(a){return O(a.trim())},Yb=function(a){return a.trim()},Zb=/^[A-Z]/,$b={type:"class",value:"[A-Z]",description:"[A-Z]"},_b=/^[a-z]/,ac={type:"class",value:"[a-z]",description:"[a-z]"},bc="\r",cc={type:"literal",value:"\r",description:'"\\r"'},dc=/^[0-9]/,ec={type:"class",value:"[0-9]",description:"[0-9]"},fc="A",gc={type:"literal",value:"A",description:'"A"'},hc="B",ic={type:"literal",value:"B",description:'"B"'},jc="C",kc={type:"literal",value:"C",description:'"C"'},lc="D",mc={type:"literal",value:"D",description:'"D"'},nc="E",oc={type:"literal",value:"E",description:'"E"'},pc="F",qc={type:"literal",value:"F",description:'"F"'},rc="	",sc={type:"literal",value:"	",description:'"\\t"'},tc="\n",uc={type:"literal",value:"\n",description:'"\\n"'},vc=" ",wc={type:"literal",value:" ",description:'" "'},xc=0,yc=0,zc=0,Ac={line:1,column:1,seenCR:!1},Bc=0,Cc=[],Dc=0;if("startRule"in Q){if(!(Q.startRule in S))throw Error("Can't start parsing from rule \""+Q.startRule+'".');T=S[Q.startRule]}if(P=T(),P!==R&&xc===a.length)return P;throw P!==R&&xc<a.length&&e({type:"end",description:"end of input"}),f(null,Cc,Bc)}return a(b,Error),{SyntaxError:b,parse:c}}();b?module.exports=c:(a.PixivNovelParser=a.PixivNovelParser||{},a.PixivNovelParser.basicParser=c)}((this||0).self||global),function(a){"use strict";function b(a){a=a||{},this.syntax=a.syntax||"basic",this.tree=[]}var c,d,e="process"in a;e?(c=require("./parser.peg.js"),d=require("./parser-extended.peg.js")):(c=PixivNovelParser.parser,d=PixivNovelParser.parser),b.parse=function(a,b){b=b||{},b.syntax=b.syntax||"basic";try{switch(a=a.replace(/\r?\n/g,"\n").replace(/[\s\u200c]/g,function(a){return"\n"===a||"　"===a?a:" "}),b.syntax){case"extended":return d.parse(a);case"basic":default:return c.parse(a)}}catch(e){return console.error(e),[{type:"text",val:a}]}},b.prototype.parse=function(a){return this.tree=b.parse(a,{syntax:this.syntax}),this},b.prototype.toJSON=function(){return JSON.stringify(this.tree)},e?module.exports={Parser:b}:(a.PixivNovelParser=a.PixivNovalPerser||{},a.PixivNovelParser.Parser=b)}((this||0).self||global),function(a){"use strict";var b="process"in a;b?module.exports=require("./parser"):a.PixivNovelParser=a.PixivNovelParser||{}}((this||0).self||global);
//# sourceMappingURL=pixiv-novel-parser.min.js.map