!function(a){var b="process"in a,c=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Dc,Cc)}function d(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Ec!==b&&(Ec>b&&(Ec=0,Fc={line:1,column:1,seenCR:!1}),c(Fc,Ec,b),Ec=b),Fc}function e(a){Gc>Cc||(Cc>Gc&&(Gc=Cc,Hc=[]),Hc.push(a))}function f(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=d(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==c?c:h(e,j),e,j,f,i.line,i.column)}function g(){var a;return a=h()}function h(){var a,b;for(a=[],b=j(),b===T&&(b=i());b!==T;)a.push(b),b=j(),b===T&&(b=i());return a}function i(){var b,c,d,f,g,h,i;if(b=Cc,c=Cc,d=[],f=[],X.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Y)),g!==T)for(;g!==T;)f.push(g),X.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Y));else f=W;if(f===T&&(f=Cc,g=Cc,Ic++,h=Cc,Ic++,i=j(),Ic--,i===T?h=Z:(Cc=h,h=W),Ic--,h!==T?(Cc=g,g=Z):g=W,g!==T?(91===a.charCodeAt(Cc)?(h=$,Cc++):(h=T,0===Ic&&e(_)),h!==T?(g=[g,h],f=g):(Cc=f,f=W)):(Cc=f,f=W)),f!==T)for(;f!==T;){if(d.push(f),f=[],X.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Y)),g!==T)for(;g!==T;)f.push(g),X.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Y));else f=W;f===T&&(f=Cc,g=Cc,Ic++,h=Cc,Ic++,i=j(),Ic--,i===T?h=Z:(Cc=h,h=W),Ic--,h!==T?(Cc=g,g=Z):g=W,g!==T?(91===a.charCodeAt(Cc)?(h=$,Cc++):(h=T,0===Ic&&e(_)),h!==T?(g=[g,h],f=g):(Cc=f,f=W)):(Cc=f,f=W))}else d=W;return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=ab(c)),b=c}function j(){var a,b;return a=k(),a===T&&(a=l(),a===T&&(a=m(),a===T&&(a=n(),a===T&&(a=o(),a===T&&(a=Cc,b=v(),b!==T&&(Dc=a,b=bb()),a=b,a===T&&(a=Cc,b=w(),b!==T&&(Dc=a,b=bb()),a=b,a===T&&(a=Cc,b=x(),b!==T&&(Dc=a,b=bb()),a=b,a===T&&(a=Cc,b=y(),b!==T&&(Dc=a,b=bb()),a=b)))))))),a}function k(){var b,c,d;return b=Cc,a.substr(Cc,9)===cb?(c=cb,Cc+=9):(c=T,0===Ic&&e(db)),c!==T?(d=B(),d===T&&(d=F()),d===T&&(d=eb),d!==T?(Dc=b,c=fb(),b=c):(Cc=b,b=W)):(Cc=b,b=W),b}function l(){var b,c,d,f,g;return b=Cc,a.substr(Cc,9)===gb?(c=gb,Cc+=9):(c=T,0===Ic&&e(hb)),c!==T?(d=p(),d!==T?(93===a.charCodeAt(Cc)?(f=ib,Cc++):(f=T,0===Ic&&e(jb)),f!==T?(g=B(),g===T&&(g=F()),g===T&&(g=eb),g!==T?(Dc=b,c=kb(d),b=c):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W),b}function m(){var b,c,d,f,g,h;return b=Cc,a.substr(Cc,12)===lb?(c=lb,Cc+=12):(c=T,0===Ic&&e(mb)),c!==T?(d=r(),d!==T?(f=Cc,45===a.charCodeAt(Cc)?(g=nb,Cc++):(g=T,0===Ic&&e(ob)),g!==T?(h=s(),h!==T?(g=[g,h],f=g):(Cc=f,f=W)):(Cc=f,f=W),f===T&&(f=eb),f!==T?(93===a.charCodeAt(Cc)?(g=ib,Cc++):(g=T,0===Ic&&e(jb)),g!==T?(Dc=b,c=pb(d,f),b=c):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W),b}function n(){var b,c,d,f;return b=Cc,a.substr(Cc,6)===qb?(c=qb,Cc+=6):(c=T,0===Ic&&e(rb)),c!==T?(d=s(),d!==T?(93===a.charCodeAt(Cc)?(f=ib,Cc++):(f=T,0===Ic&&e(jb)),f!==T?(Dc=b,c=sb(d),b=c):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W),b}function o(){var b,c,d,f,g,h,i,j;if(b=Cc,a.substr(Cc,10)===tb?(c=tb,Cc+=10):(c=T,0===Ic&&e(ub)),c!==T)if(d=q(),d!==T)if(62===a.charCodeAt(Cc)?(f=vb,Cc++):(f=T,0===Ic&&e(wb)),f!==T){for(g=[],h=H();h!==T;)g.push(h),h=H();if(g!==T)if(h=t(),h!==T){for(i=[],j=H();j!==T;)i.push(j),j=H();i!==T?(a.substr(Cc,2)===xb?(j=xb,Cc+=2):(j=T,0===Ic&&e(yb)),j!==T?(Dc=b,c=zb(d,h),b=c):(Cc=b,b=W)):(Cc=b,b=W)}else Cc=b,b=W;else Cc=b,b=W}else Cc=b,b=W;else Cc=b,b=W;else Cc=b,b=W;return b}function p(){var b,c,d,f;for(b=Cc,c=Cc,d=[],Ab.test(a.charAt(Cc))?(f=a.charAt(Cc),Cc++):(f=T,0===Ic&&e(Bb));f!==T;)d.push(f),Ab.test(a.charAt(Cc))?(f=a.charAt(Cc),Cc++):(f=T,0===Ic&&e(Bb));return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=Cb(c)),b=c}function q(){var b,c,d,f;for(b=Cc,c=Cc,d=[],Db.test(a.charAt(Cc))?(f=a.charAt(Cc),Cc++):(f=T,0===Ic&&e(Eb));f!==T;)d.push(f),Db.test(a.charAt(Cc))?(f=a.charAt(Cc),Cc++):(f=T,0===Ic&&e(Eb));return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=Cb(c)),b=c}function r(){var b,c,d;if(b=Cc,c=[],d=C(),d!==T)for(;d!==T;)c.push(d),d=C();else c=W;return c!==T&&(c=a.substring(b,Cc)),b=c}function s(){var b,c,d,e;if(b=Cc,c=Cc,d=[],e=C(),e!==T)for(;e!==T;)d.push(e),e=C();else d=W;return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=Fb(c)),b=c}function t(){var b,c,d,f,g,h,i;if(b=Cc,c=Cc,d=Cc,f=Cc,a.substr(Cc,4)===Gb?(g=Gb,Cc+=4):(g=T,0===Ic&&e(Hb)),g!==T?(115===a.charCodeAt(Cc)?(h=Ib,Cc++):(h=T,0===Ic&&e(Jb)),h===T&&(h=eb),h!==T?(g=[g,h],f=g):(Cc=f,f=W)):(Cc=f,f=W),f===T&&(f=eb),f!==T)if(a.substr(Cc,3)===Kb?(g=Kb,Cc+=3):(g=T,0===Ic&&e(Lb)),g!==T){for(h=[],i=u();i!==T;)h.push(i),i=u();h!==T?(f=[f,g,h],d=f):(Cc=d,d=W)}else Cc=d,d=W;else Cc=d,d=W;return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=Mb(c)),b=c}function u(){var b,c,d,f;if(b=A(),b===T&&(b=C(),b===T)){if(b=Cc,37===a.charCodeAt(Cc)?(c=Nb,Cc++):(c=T,0===Ic&&e(Ob)),c!==T){if(d=[],f=D(),f!==T)for(;f!==T;)d.push(f),f=D();else d=W;d!==T?(c=[c,d],b=c):(Cc=b,b=W)}else Cc=b,b=W;b===T&&(Pb.test(a.charAt(Cc))?(b=a.charAt(Cc),Cc++):(b=T,0===Ic&&e(Qb)))}return b}function v(){var b,c,d,f,g,h,i;if(b=Cc,a.substr(Cc,6)===Rb?(c=Rb,Cc+=6):(c=T,0===Ic&&e(Sb)),c!==T){for(d=Cc,f=[],Db.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Eb));g!==T;)f.push(g),Db.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Eb));if(f!==T&&(f=a.substring(d,Cc)),d=f,d!==T)if(62===a.charCodeAt(Cc)?(f=vb,Cc++):(f=T,0===Ic&&e(wb)),f!==T){for(g=Cc,h=[],Ab.test(a.charAt(Cc))?(i=a.charAt(Cc),Cc++):(i=T,0===Ic&&e(Bb));i!==T;)h.push(i),Ab.test(a.charAt(Cc))?(i=a.charAt(Cc),Cc++):(i=T,0===Ic&&e(Bb));h!==T&&(h=a.substring(g,Cc)),g=h,g!==T?(93===a.charCodeAt(Cc)?(h=ib,Cc++):(h=T,0===Ic&&e(jb)),h!==T?(Dc=b,c=Tb(d,g),b=c):(Cc=b,b=W)):(Cc=b,b=W)}else Cc=b,b=W;else Cc=b,b=W}else Cc=b,b=W;return b}function w(){var b,c,d,f;return b=Cc,a.substr(Cc,7)===Ub?(c=Ub,Cc+=7):(c=T,0===Ic&&e(Vb)),c!==T?(d=z(),d!==T?(93===a.charCodeAt(Cc)?(f=ib,Cc++):(f=T,0===Ic&&e(jb)),f!==T?(Dc=b,c=Wb(d),b=c):(Cc=b,b=W)):(Cc=b,b=W)):(Cc=b,b=W),b}function x(){var b,c,d,f,g;if(b=Cc,a.substr(Cc,8)===Xb?(c=Xb,Cc+=8):(c=T,0===Ic&&e(Yb)),c!==T){for(d=Cc,f=[],Ab.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Bb));g!==T;)f.push(g),Ab.test(a.charAt(Cc))?(g=a.charAt(Cc),Cc++):(g=T,0===Ic&&e(Bb));f!==T&&(f=a.substring(d,Cc)),d=f,d!==T?(93===a.charCodeAt(Cc)?(f=ib,Cc++):(f=T,0===Ic&&e(jb)),f!==T?(Dc=b,c=Zb(d),b=c):(Cc=b,b=W)):(Cc=b,b=W)}else Cc=b,b=W;return b}function y(){var b,c;return b=Cc,a.substr(Cc,9)===$b?(c=$b,Cc+=9):(c=T,0===Ic&&e(_b)),c!==T&&(Dc=b,c=ac()),b=c}function z(){var b,c,d,f;if(b=Cc,c=Cc,d=[],f=A(),f===T&&(f=C(),f===T&&(45===a.charCodeAt(Cc)?(f=nb,Cc++):(f=T,0===Ic&&e(ob)))),f!==T)for(;f!==T;)d.push(f),f=A(),f===T&&(f=C(),f===T&&(45===a.charCodeAt(Cc)?(f=nb,Cc++):(f=T,0===Ic&&e(ob))));else d=W;return d!==T&&(d=a.substring(c,Cc)),c=d,c!==T&&(Dc=b,c=bc(c)),b=c}function A(){var b;return cc.test(a.charAt(Cc))?(b=a.charAt(Cc),Cc++):(b=T,0===Ic&&e(dc)),b===T&&(ec.test(a.charAt(Cc))?(b=a.charAt(Cc),Cc++):(b=T,0===Ic&&e(fc))),b}function B(){var b;return 13===a.charCodeAt(Cc)?(b=gc,Cc++):(b=T,0===Ic&&e(hc)),b}function C(){var b;return ic.test(a.charAt(Cc))?(b=a.charAt(Cc),Cc++):(b=T,0===Ic&&e(jc)),b}function D(){var b;return b=C(),b===T&&(65===a.charCodeAt(Cc)?(b=kc,Cc++):(b=T,0===Ic&&e(lc)),b===T&&(66===a.charCodeAt(Cc)?(b=mc,Cc++):(b=T,0===Ic&&e(nc)),b===T&&(67===a.charCodeAt(Cc)?(b=oc,Cc++):(b=T,0===Ic&&e(pc)),b===T&&(68===a.charCodeAt(Cc)?(b=qc,Cc++):(b=T,0===Ic&&e(rc)),b===T&&(69===a.charCodeAt(Cc)?(b=sc,Cc++):(b=T,0===Ic&&e(tc)),b===T&&(70===a.charCodeAt(Cc)?(b=uc,Cc++):(b=T,0===Ic&&e(vc)))))))),b}function E(){var b;return 9===a.charCodeAt(Cc)?(b=wc,Cc++):(b=T,0===Ic&&e(xc)),b}function F(){var b;return 10===a.charCodeAt(Cc)?(b=yc,Cc++):(b=T,0===Ic&&e(zc)),b}function G(){var b;return 32===a.charCodeAt(Cc)?(b=Ac,Cc++):(b=T,0===Ic&&e(Bc)),b}function H(){var a;return a=G(),a===T&&(a=E()),a}function c(a){return{type:"text",val:a}}function I(){return{type:"tag",name:"newpage"}}function J(a){return{type:"tag",name:"chapter",title:a}}function K(a,b){return{type:"tag",name:"pixivimage",illustID:a,pageNumber:b||null}}function L(a){return{type:"tag",name:"jump",pageNumber:a}}function M(a,b){return{type:"tag",name:"jumpuri",title:a,uri:b}}function N(a,b){return{type:"tag",name:"ruby",rubyBase:a,rubyText:b}}function O(a){return{type:"tag",name:"emoji",emojiName:a}}function P(a){return{type:"tag",name:"strong",val:a}}function Q(){return{type:"tag",name:"momonga"}}var R,S=arguments.length>1?arguments[1]:{},T={},U={start:g},V=g,W=T,X=/^[^[]/,Y={type:"class",value:"[^[]",description:"[^[]"},Z=void 0,$="[",_={type:"literal",value:"[",description:'"["'},ab=function(a){return c(a)},bb=function(){return __$__},cb="[newpage]",db={type:"literal",value:"[newpage]",description:'"[newpage]"'},eb=null,fb=function(){return I()},gb="[chapter:",hb={type:"literal",value:"[chapter:",description:'"[chapter:"'},ib="]",jb={type:"literal",value:"]",description:'"]"'},kb=function(a){return J(a)},lb="[pixivimage:",mb={type:"literal",value:"[pixivimage:",description:'"[pixivimage:"'},nb="-",ob={type:"literal",value:"-",description:'"-"'},pb=function(a,b){return K(a,b&&b[1])},qb="[jump:",rb={type:"literal",value:"[jump:",description:'"[jump:"'},sb=function(a){return L(a)},tb="[[jumpuri:",ub={type:"literal",value:"[[jumpuri:",description:'"[[jumpuri:"'},vb=">",wb={type:"literal",value:">",description:'">"'},xb="]]",yb={type:"literal",value:"]]",description:'"]]"'},zb=function(a,b){return M(a,b)},Ab=/^[^\]]/,Bb={type:"class",value:"[^\\]]",description:"[^\\]]"},Cb=function(a){return a.trim()},Db=/^[^>]/,Eb={type:"class",value:"[^>]",description:"[^>]"},Fb=function(a){return parseInt(a,10)},Gb="http",Hb={type:"literal",value:"http",description:'"http"'},Ib="s",Jb={type:"literal",value:"s",description:'"s"'},Kb="://",Lb={type:"literal",value:"://",description:'"://"'},Mb=function(a){return a},Nb="%",Ob={type:"literal",value:"%",description:'"%"'},Pb=/^[\-._~!$&'()*+,;=:\/@.?#]/,Qb={type:"class",value:"[\\-._~!$&'()*+,;=:\\/@.?#]",description:"[\\-._~!$&'()*+,;=:\\/@.?#]"},Rb="[ruby:",Sb={type:"literal",value:"[ruby:",description:'"[ruby:"'},Tb=function(a,b){return N(a.trim(),b.trim())},Ub="[emoji:",Vb={type:"literal",value:"[emoji:",description:'"[emoji:"'},Wb=function(a){return O(a)},Xb="[strong:",Yb={type:"literal",value:"[strong:",description:'"[strong:"'},Zb=function(a){return P(a.trim())},$b="[momonga]",_b={type:"literal",value:"[momonga]",description:'"[momonga]"'},ac=function(){return Q()},bc=function(a){return a.trim()},cc=/^[A-Z]/,dc={type:"class",value:"[A-Z]",description:"[A-Z]"},ec=/^[a-z]/,fc={type:"class",value:"[a-z]",description:"[a-z]"},gc="\r",hc={type:"literal",value:"\r",description:'"\\r"'},ic=/^[0-9]/,jc={type:"class",value:"[0-9]",description:"[0-9]"},kc="A",lc={type:"literal",value:"A",description:'"A"'},mc="B",nc={type:"literal",value:"B",description:'"B"'},oc="C",pc={type:"literal",value:"C",description:'"C"'},qc="D",rc={type:"literal",value:"D",description:'"D"'},sc="E",tc={type:"literal",value:"E",description:'"E"'},uc="F",vc={type:"literal",value:"F",description:'"F"'},wc="	",xc={type:"literal",value:"	",description:'"\\t"'},yc="\n",zc={type:"literal",value:"\n",description:'"\\n"'},Ac=" ",Bc={type:"literal",value:" ",description:'" "'},Cc=0,Dc=0,Ec=0,Fc={line:1,column:1,seenCR:!1},Gc=0,Hc=[],Ic=0;if("startRule"in S){if(!(S.startRule in U))throw Error("Can't start parsing from rule \""+S.startRule+'".');V=U[S.startRule]}if(R=V(),R!==T&&Cc===a.length)return R;throw R!==T&&Cc<a.length&&e({type:"end",description:"end of input"}),f(null,Hc,Gc)}return a(b,Error),{SyntaxError:b,parse:c}}();b?module.exports=c:(a.PixivNovelParser=a.PixivNovelParser||{},a.PixivNovelParser.basicParser=c)}((this||0).self||global),function(a){var b="process"in a,c=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Cc,Bc)}function d(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Dc!==b&&(Dc>b&&(Dc=0,Ec={line:1,column:1,seenCR:!1}),c(Ec,Dc,b),Dc=b),Ec}function e(a){Fc>Bc||(Bc>Fc&&(Fc=Bc,Gc=[]),Gc.push(a))}function f(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=d(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==c?c:h(e,j),e,j,f,i.line,i.column)}function g(){var a;return a=h()}function h(){var a,b;for(a=[],b=j(),b===T&&(b=i());b!==T;)a.push(b),b=j(),b===T&&(b=i());return a}function i(){var b,c,d,f,g,h,i;if(b=Bc,c=Bc,d=[],f=[],X.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Y)),g!==T)for(;g!==T;)f.push(g),X.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Y));else f=W;if(f===T&&(f=Bc,g=Bc,Hc++,h=Bc,Hc++,i=j(),Hc--,i===T?h=Z:(Bc=h,h=W),Hc--,h!==T?(Bc=g,g=Z):g=W,g!==T?(91===a.charCodeAt(Bc)?(h=$,Bc++):(h=T,0===Hc&&e(_)),h!==T?(g=[g,h],f=g):(Bc=f,f=W)):(Bc=f,f=W)),f!==T)for(;f!==T;){if(d.push(f),f=[],X.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Y)),g!==T)for(;g!==T;)f.push(g),X.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Y));else f=W;f===T&&(f=Bc,g=Bc,Hc++,h=Bc,Hc++,i=j(),Hc--,i===T?h=Z:(Bc=h,h=W),Hc--,h!==T?(Bc=g,g=Z):g=W,g!==T?(91===a.charCodeAt(Bc)?(h=$,Bc++):(h=T,0===Hc&&e(_)),h!==T?(g=[g,h],f=g):(Bc=f,f=W)):(Bc=f,f=W))}else d=W;return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=ab(c)),b=c}function j(){var a;return a=k(),a===T&&(a=l(),a===T&&(a=m(),a===T&&(a=n(),a===T&&(a=o(),a===T&&(a=v(),a===T&&(a=w(),a===T&&(a=x(),a===T&&(a=y())))))))),a}function k(){var b,c,d;return b=Bc,a.substr(Bc,9)===bb?(c=bb,Bc+=9):(c=T,0===Hc&&e(cb)),c!==T?(d=B(),d===T&&(d=F()),d===T&&(d=db),d!==T?(Cc=b,c=eb(),b=c):(Bc=b,b=W)):(Bc=b,b=W),b}function l(){var b,c,d,f,g;return b=Bc,a.substr(Bc,9)===fb?(c=fb,Bc+=9):(c=T,0===Hc&&e(gb)),c!==T?(d=p(),d!==T?(93===a.charCodeAt(Bc)?(f=hb,Bc++):(f=T,0===Hc&&e(ib)),f!==T?(g=B(),g===T&&(g=F()),g===T&&(g=db),g!==T?(Cc=b,c=jb(d),b=c):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W),b}function m(){var b,c,d,f,g,h;return b=Bc,a.substr(Bc,12)===kb?(c=kb,Bc+=12):(c=T,0===Hc&&e(lb)),c!==T?(d=r(),d!==T?(f=Bc,45===a.charCodeAt(Bc)?(g=mb,Bc++):(g=T,0===Hc&&e(nb)),g!==T?(h=s(),h!==T?(g=[g,h],f=g):(Bc=f,f=W)):(Bc=f,f=W),f===T&&(f=db),f!==T?(93===a.charCodeAt(Bc)?(g=hb,Bc++):(g=T,0===Hc&&e(ib)),g!==T?(Cc=b,c=ob(d,f),b=c):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W),b}function n(){var b,c,d,f;return b=Bc,a.substr(Bc,6)===pb?(c=pb,Bc+=6):(c=T,0===Hc&&e(qb)),c!==T?(d=s(),d!==T?(93===a.charCodeAt(Bc)?(f=hb,Bc++):(f=T,0===Hc&&e(ib)),f!==T?(Cc=b,c=rb(d),b=c):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W),b}function o(){var b,c,d,f,g,h,i,j;if(b=Bc,a.substr(Bc,10)===sb?(c=sb,Bc+=10):(c=T,0===Hc&&e(tb)),c!==T)if(d=q(),d!==T)if(62===a.charCodeAt(Bc)?(f=ub,Bc++):(f=T,0===Hc&&e(vb)),f!==T){for(g=[],h=H();h!==T;)g.push(h),h=H();if(g!==T)if(h=t(),h!==T){for(i=[],j=H();j!==T;)i.push(j),j=H();i!==T?(a.substr(Bc,2)===wb?(j=wb,Bc+=2):(j=T,0===Hc&&e(xb)),j!==T?(Cc=b,c=yb(d,h),b=c):(Bc=b,b=W)):(Bc=b,b=W)}else Bc=b,b=W;else Bc=b,b=W}else Bc=b,b=W;else Bc=b,b=W;else Bc=b,b=W;return b}function p(){var b,c,d,f;for(b=Bc,c=Bc,d=[],zb.test(a.charAt(Bc))?(f=a.charAt(Bc),Bc++):(f=T,0===Hc&&e(Ab));f!==T;)d.push(f),zb.test(a.charAt(Bc))?(f=a.charAt(Bc),Bc++):(f=T,0===Hc&&e(Ab));return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=Bb(c)),b=c}function q(){var b,c,d,f;for(b=Bc,c=Bc,d=[],Cb.test(a.charAt(Bc))?(f=a.charAt(Bc),Bc++):(f=T,0===Hc&&e(Db));f!==T;)d.push(f),Cb.test(a.charAt(Bc))?(f=a.charAt(Bc),Bc++):(f=T,0===Hc&&e(Db));return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=Bb(c)),b=c}function r(){var b,c,d;if(b=Bc,c=[],d=C(),d!==T)for(;d!==T;)c.push(d),d=C();else c=W;return c!==T&&(c=a.substring(b,Bc)),b=c}function s(){var b,c,d,e;if(b=Bc,c=Bc,d=[],e=C(),e!==T)for(;e!==T;)d.push(e),e=C();else d=W;return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=Eb(c)),b=c}function t(){var b,c,d,f,g,h,i;if(b=Bc,c=Bc,d=Bc,f=Bc,a.substr(Bc,4)===Fb?(g=Fb,Bc+=4):(g=T,0===Hc&&e(Gb)),g!==T?(115===a.charCodeAt(Bc)?(h=Hb,Bc++):(h=T,0===Hc&&e(Ib)),h===T&&(h=db),h!==T?(g=[g,h],f=g):(Bc=f,f=W)):(Bc=f,f=W),f===T&&(f=db),f!==T)if(a.substr(Bc,3)===Jb?(g=Jb,Bc+=3):(g=T,0===Hc&&e(Kb)),g!==T){for(h=[],i=u();i!==T;)h.push(i),i=u();h!==T?(f=[f,g,h],d=f):(Bc=d,d=W)}else Bc=d,d=W;else Bc=d,d=W;return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=Lb(c)),b=c}function u(){var b,c,d,f;if(b=A(),b===T&&(b=C(),b===T)){if(b=Bc,37===a.charCodeAt(Bc)?(c=Mb,Bc++):(c=T,0===Hc&&e(Nb)),c!==T){if(d=[],f=D(),f!==T)for(;f!==T;)d.push(f),f=D();else d=W;d!==T?(c=[c,d],b=c):(Bc=b,b=W)}else Bc=b,b=W;b===T&&(Ob.test(a.charAt(Bc))?(b=a.charAt(Bc),Bc++):(b=T,0===Hc&&e(Pb)))}return b}function v(){var b,c,d,f,g,h,i;if(b=Bc,a.substr(Bc,6)===Qb?(c=Qb,Bc+=6):(c=T,0===Hc&&e(Rb)),c!==T){for(d=Bc,f=[],Cb.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Db));g!==T;)f.push(g),Cb.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Db));if(f!==T&&(f=a.substring(d,Bc)),d=f,d!==T)if(62===a.charCodeAt(Bc)?(f=ub,Bc++):(f=T,0===Hc&&e(vb)),f!==T){for(g=Bc,h=[],zb.test(a.charAt(Bc))?(i=a.charAt(Bc),Bc++):(i=T,0===Hc&&e(Ab));i!==T;)h.push(i),zb.test(a.charAt(Bc))?(i=a.charAt(Bc),Bc++):(i=T,0===Hc&&e(Ab));h!==T&&(h=a.substring(g,Bc)),g=h,g!==T?(93===a.charCodeAt(Bc)?(h=hb,Bc++):(h=T,0===Hc&&e(ib)),h!==T?(Cc=b,c=Sb(d,g),b=c):(Bc=b,b=W)):(Bc=b,b=W)}else Bc=b,b=W;else Bc=b,b=W}else Bc=b,b=W;return b}function w(){var b,c,d,f;return b=Bc,a.substr(Bc,7)===Tb?(c=Tb,Bc+=7):(c=T,0===Hc&&e(Ub)),c!==T?(d=z(),d!==T?(93===a.charCodeAt(Bc)?(f=hb,Bc++):(f=T,0===Hc&&e(ib)),f!==T?(Cc=b,c=Vb(d),b=c):(Bc=b,b=W)):(Bc=b,b=W)):(Bc=b,b=W),b}function x(){var b,c,d,f,g;if(b=Bc,a.substr(Bc,8)===Wb?(c=Wb,Bc+=8):(c=T,0===Hc&&e(Xb)),c!==T){for(d=Bc,f=[],zb.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Ab));g!==T;)f.push(g),zb.test(a.charAt(Bc))?(g=a.charAt(Bc),Bc++):(g=T,0===Hc&&e(Ab));f!==T&&(f=a.substring(d,Bc)),d=f,d!==T?(93===a.charCodeAt(Bc)?(f=hb,Bc++):(f=T,0===Hc&&e(ib)),f!==T?(Cc=b,c=Yb(d),b=c):(Bc=b,b=W)):(Bc=b,b=W)}else Bc=b,b=W;return b}function y(){var b,c;return b=Bc,a.substr(Bc,9)===Zb?(c=Zb,Bc+=9):(c=T,0===Hc&&e($b)),c!==T&&(Cc=b,c=_b()),b=c}function z(){var b,c,d,f;if(b=Bc,c=Bc,d=[],f=A(),f===T&&(f=C(),f===T&&(45===a.charCodeAt(Bc)?(f=mb,Bc++):(f=T,0===Hc&&e(nb)))),f!==T)for(;f!==T;)d.push(f),f=A(),f===T&&(f=C(),f===T&&(45===a.charCodeAt(Bc)?(f=mb,Bc++):(f=T,0===Hc&&e(nb))));else d=W;return d!==T&&(d=a.substring(c,Bc)),c=d,c!==T&&(Cc=b,c=ac(c)),b=c}function A(){var b;return bc.test(a.charAt(Bc))?(b=a.charAt(Bc),Bc++):(b=T,0===Hc&&e(cc)),b===T&&(dc.test(a.charAt(Bc))?(b=a.charAt(Bc),Bc++):(b=T,0===Hc&&e(ec))),b}function B(){var b;return 13===a.charCodeAt(Bc)?(b=fc,Bc++):(b=T,0===Hc&&e(gc)),b}function C(){var b;return hc.test(a.charAt(Bc))?(b=a.charAt(Bc),Bc++):(b=T,0===Hc&&e(ic)),b}function D(){var b;return b=C(),b===T&&(65===a.charCodeAt(Bc)?(b=jc,Bc++):(b=T,0===Hc&&e(kc)),b===T&&(66===a.charCodeAt(Bc)?(b=lc,Bc++):(b=T,0===Hc&&e(mc)),b===T&&(67===a.charCodeAt(Bc)?(b=nc,Bc++):(b=T,0===Hc&&e(oc)),b===T&&(68===a.charCodeAt(Bc)?(b=pc,Bc++):(b=T,0===Hc&&e(qc)),b===T&&(69===a.charCodeAt(Bc)?(b=rc,Bc++):(b=T,0===Hc&&e(sc)),b===T&&(70===a.charCodeAt(Bc)?(b=tc,Bc++):(b=T,0===Hc&&e(uc)))))))),b}function E(){var b;return 9===a.charCodeAt(Bc)?(b=vc,Bc++):(b=T,0===Hc&&e(wc)),b}function F(){var b;return 10===a.charCodeAt(Bc)?(b=xc,Bc++):(b=T,0===Hc&&e(yc)),b}function G(){var b;return 32===a.charCodeAt(Bc)?(b=zc,Bc++):(b=T,0===Hc&&e(Ac)),b}function H(){var a;return a=G(),a===T&&(a=E()),a}function c(a){return{type:"text",val:a}}function I(){return{type:"tag",name:"newpage"}}function J(a){return{type:"tag",name:"chapter",title:a}}function K(a,b){return{type:"tag",name:"pixivimage",illustID:a,pageNumber:b||null}}function L(a){return{type:"tag",name:"jump",pageNumber:a}}function M(a,b){return{type:"tag",name:"jumpuri",title:a,uri:b}}function N(a,b){return{type:"tag",name:"ruby",rubyBase:a,rubyText:b}}function O(a){return{type:"tag",name:"emoji",emojiName:a}}function P(a){return{type:"tag",name:"strong",val:a}}function Q(){return{type:"tag",name:"momonga"}}var R,S=arguments.length>1?arguments[1]:{},T={},U={start:g},V=g,W=T,X=/^[^[]/,Y={type:"class",value:"[^[]",description:"[^[]"},Z=void 0,$="[",_={type:"literal",value:"[",description:'"["'},ab=function(a){return c(a)},bb="[newpage]",cb={type:"literal",value:"[newpage]",description:'"[newpage]"'},db=null,eb=function(){return I()},fb="[chapter:",gb={type:"literal",value:"[chapter:",description:'"[chapter:"'},hb="]",ib={type:"literal",value:"]",description:'"]"'},jb=function(a){return J(a)},kb="[pixivimage:",lb={type:"literal",value:"[pixivimage:",description:'"[pixivimage:"'},mb="-",nb={type:"literal",value:"-",description:'"-"'},ob=function(a,b){return K(a,b&&b[1])},pb="[jump:",qb={type:"literal",value:"[jump:",description:'"[jump:"'},rb=function(a){return L(a)},sb="[[jumpuri:",tb={type:"literal",value:"[[jumpuri:",description:'"[[jumpuri:"'},ub=">",vb={type:"literal",value:">",description:'">"'},wb="]]",xb={type:"literal",value:"]]",description:'"]]"'},yb=function(a,b){return M(a,b)},zb=/^[^\]]/,Ab={type:"class",value:"[^\\]]",description:"[^\\]]"},Bb=function(a){return a.trim()},Cb=/^[^>]/,Db={type:"class",value:"[^>]",description:"[^>]"},Eb=function(a){return parseInt(a,10)},Fb="http",Gb={type:"literal",value:"http",description:'"http"'},Hb="s",Ib={type:"literal",value:"s",description:'"s"'},Jb="://",Kb={type:"literal",value:"://",description:'"://"'},Lb=function(a){return a},Mb="%",Nb={type:"literal",value:"%",description:'"%"'},Ob=/^[\-._~!$&'()*+,;=:\/@.?#]/,Pb={type:"class",value:"[\\-._~!$&'()*+,;=:\\/@.?#]",description:"[\\-._~!$&'()*+,;=:\\/@.?#]"},Qb="[ruby:",Rb={type:"literal",value:"[ruby:",description:'"[ruby:"'},Sb=function(a,b){return N(a.trim(),b.trim())},Tb="[emoji:",Ub={type:"literal",value:"[emoji:",description:'"[emoji:"'},Vb=function(a){return O(a)},Wb="[strong:",Xb={type:"literal",value:"[strong:",description:'"[strong:"'},Yb=function(a){return P(a.trim())},Zb="[momonga]",$b={type:"literal",value:"[momonga]",description:'"[momonga]"'},_b=function(){return Q()},ac=function(a){return a.trim()},bc=/^[A-Z]/,cc={type:"class",value:"[A-Z]",description:"[A-Z]"},dc=/^[a-z]/,ec={type:"class",value:"[a-z]",description:"[a-z]"},fc="\r",gc={type:"literal",value:"\r",description:'"\\r"'},hc=/^[0-9]/,ic={type:"class",value:"[0-9]",description:"[0-9]"},jc="A",kc={type:"literal",value:"A",description:'"A"'},lc="B",mc={type:"literal",value:"B",description:'"B"'},nc="C",oc={type:"literal",value:"C",description:'"C"'},pc="D",qc={type:"literal",value:"D",description:'"D"'},rc="E",sc={type:"literal",value:"E",description:'"E"'},tc="F",uc={type:"literal",value:"F",description:'"F"'},vc="	",wc={type:"literal",value:"	",description:'"\\t"'},xc="\n",yc={type:"literal",value:"\n",description:'"\\n"'},zc=" ",Ac={type:"literal",value:" ",description:'" "'},Bc=0,Cc=0,Dc=0,Ec={line:1,column:1,seenCR:!1},Fc=0,Gc=[],Hc=0;if("startRule"in S){if(!(S.startRule in U))throw Error("Can't start parsing from rule \""+S.startRule+'".');V=U[S.startRule]}if(R=V(),R!==T&&Bc===a.length)return R;throw R!==T&&Bc<a.length&&e({type:"end",description:"end of input"}),f(null,Gc,Fc)}return a(b,Error),{SyntaxError:b,parse:c}}();b?module.exports=c:(a.PixivNovelParser=a.PixivNovelParser||{},a.PixivNovelParser.extendedParser=c)}((this||0).self||global),function(a){"use strict";function b(a){a=a||{},this.syntax=a.syntax||"basic",this.tree=[]}var c,d,e="process"in a;e?(c=require("./parser.peg.js"),d=require("./parser-extended.peg.js")):(c=PixivNovelParser.basicParser,d=PixivNovelParser.extendedParser),b.parse=function(a,b){b=b||{},b.syntax=b.syntax||"basic";try{switch(a=a.replace(/\r?\n/g,"\n").replace(/[\s\u200c]/g,function(a){return"\n"===a||"　"===a?a:" "}),b.syntax){case"extended":return d.parse(a);case"basic":default:return c.parse(a)}}catch(e){return console.error(e),[{type:"text",val:a}]}},b.prototype.parse=function(a){return this.tree=b.parse(a,{syntax:this.syntax}),this},b.prototype.toJSON=function(){return JSON.stringify(this.tree)},e?module.exports={Parser:b}:(a.PixivNovelParser=a.PixivNovalPerser||{},a.PixivNovelParser.Parser=b)}((this||0).self||global),function(a){"use strict";var b="process"in a;b?module.exports=require("./parser"):a.PixivNovelParser=a.PixivNovelParser||{}}((this||0).self||global);
//# sourceMappingURL=pixiv-novel-parser.min.js.map